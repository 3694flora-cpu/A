<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»æ± å……æ”¾é›»éŠæˆ²</title>
    <style>
        /* --- CSS æ¨£å¼ (åŒ…å«æ‚¨æä¾›çš„å’Œä¿®æ”¹å¾Œçš„) --- */

        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 30px;
            background-color: #f4f4f9;
            color: #333;
        }

        h1 {
            color: #4a4a4a;
        }

        /* --- é ‚éƒ¨è³‡è¨Šæ¿èˆ‡æŒ‰éˆ• --- */
        #timer-board {
            margin-bottom: 15px;
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }

        .time-low {
            color: #dc3545;
        }

        #high-score-board {
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: bold;
            color: #ffc107;
        }

        #score-board {
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        /* éŠæˆ²æ§åˆ¶æŒ‰éˆ•æ¨£å¼ */
        #reset-button {
            padding: 10px 20px;
            margin-bottom: 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #f0ad4e;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
            margin-right: 10px;
        }

        #reset-button:hover {
            background-color: #ec971f;
        }

        #mode-toggle-button {
            padding: 8px 15px;
            margin-bottom: 20px;
            font-size: 14px;
            cursor: pointer;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        #mode-toggle-button:hover {
            background-color: #5a6268;
        }


        /* --- å®¹å™¨ --- */
        #slots-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            width: 90%;
            max-width: 800px;
            margin: 30px 0;
            min-height: 100px;
        }

        /* --- é›»æ± å®¹å™¨æ¨£å¼ --- */
        #battery-container {
            display: flex;
            justify-content: center;
            gap: 30px; /* é›»æ± ä¹‹é–“çš„é–“è· */
            align-items: center;
            width: 100%;
            padding: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* --- å–®å€‹é›»æ± æ¨£å¼ --- */
        .battery {
            position: relative;
            width: 50px; /* é›»æ± å¯¬åº¦ */
            height: 120px; /* é›»æ± é«˜åº¦ */
            background-color: #343a40; /* é›»æ± ä¸»é«”é¡è‰² (æ·±è‰²) */
            border-radius: 10px; /* åœ“è§’é›»æ± é«” */
            border: 3px solid #6c757d;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* ç¢ºä¿é›»é‡ä¸æœƒæº¢å‡º */
            cursor: pointer;
            transition: transform 0.2s;
        }

        .battery:hover {
            transform: scale(1.05); /* æ»‘é¼ æ‡¸åœæ•ˆæœ */
        }

        /* é›»æ± æ­£æ¥µé ­ */
        .battery::before {
            content: '';
            position: absolute;
            top: -5px; /* æ”¾åœ¨é›»æ± é ‚éƒ¨ä¹‹å¤– */
            left: 50%;
            transform: translateX(-50%);
            width: 50%;
            height: 5px;
            background-color: #ced4da; /* æ·ºç°è‰²é‡‘å±¬è³ªæ„Ÿ */
            border-radius: 5px 5px 0 0;
            z-index: 2;
        }

        /* é›»æ± é›»é‡æ¢ */
        .charge-level {
            position: absolute;
            bottom: 0;
            width: 100%;
            background-color: #28a745; /* é è¨­é«˜é›»é‡é¡è‰² (ç¶ è‰²) */
            transition: height 0.5s ease-out, background-color 0.5s;
        }

        /* --- é›»é‡ç‹€æ…‹é¡è‰² --- */
        .charge-full {
            background-color: #28a745; /* ç¶ è‰² */
        }

        .charge-mid {
            background-color: #ffc107; /* é»ƒè‰²/ç¥ç€è‰² */
        }

        .charge-low {
            background-color: #dc3545; /* ç´…è‰² */
        }

        /* --- ã€Œå½ˆç°§ã€æ–‡å­—çš„æ¨£å¼ --- */
        .spring-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #adb5bd; /* æ·ºç°è‰² */
            font-size: 0.8em;
            font-weight: bold;
            text-align: center;
            z-index: 3;
            pointer-events: none;
        }

        .game-over-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: none; /* é è¨­éš±è— */
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-size: 2em;
            z-index: 10;
        }
    </style>
</head>
<body>

    <h1>ğŸ”‹ é›»æ± å……æ”¾é›»æŒ‘æˆ°</h1>

    <div id="high-score-board">æœ€é«˜åˆ†æ•¸: <span id="high-score">0</span></div>
    <div id="timer-board">æ™‚é–“: <span id="timer">60</span>s</div>
    <div id="score-board">åˆ†æ•¸: <span id="score">0</span></div>

    <div>
        <button id="reset-button">é‡ç½®éŠæˆ²</button>
        <button id="mode-toggle-button">åˆ‡æ›æ¨¡å¼ (ç›®å‰: è€—é›»)</button>
    </div>

    <div id="slots-container">
        <div id="battery-container">
            </div>
    </div>
    
    <div id="game-over-overlay" class="game-over-overlay">
        <h2>éŠæˆ²çµæŸï¼</h2>
        <p>æ‚¨çš„åˆ†æ•¸æ˜¯: <span id="final-score">0</span></p>
        <button onclick="resetGame()" style="margin-top: 20px; padding: 10px 30px;">å†ç©ä¸€æ¬¡</button>
    </div>

    <script>
        // --- JavaScript äº’å‹•é‚è¼¯ ---

        // éŠæˆ²åƒæ•¸
        const INITIAL_TIME = 60;
        const NUM_BATTERIES = 5;
        const DISCHARGE_AMOUNT = 20; // æ¯æ¬¡é»æ“Šè€—é›»é‡ (%)
        const CHARGE_AMOUNT = 10;    // æ¯æ¬¡é»æ“Šå……é›»é‡ (%)

        let score = 0;
        let timeLeft = INITIAL_TIME;
        let timerInterval;
        let isRunning = false;
        let isDischargeMode = true; // true = è€—é›»æ¨¡å¼ (é è¨­), false = å……é›»æ¨¡å¼
        let highscore = localStorage.getItem('batteryHighscore') || 0;

        // DOM å…ƒç´ 
        const timerEl = document.getElementById('timer');
        const scoreEl = document.getElementById('score');
        const highscoreEl = document.getElementById('high-score');
        const batteryContainer = document.getElementById('battery-container');
        const modeToggleBtn = document.getElementById('mode-toggle-button');
        const gameOverOverlay = document.getElementById('game-over-overlay');
        const finalScoreEl = document.getElementById('final-score');
        
        // é›»æ± ç‹€æ…‹é™£åˆ— (å„²å­˜æ¯å€‹é›»æ± çš„é›»é‡ 0-100)
        let batteryLevels = []; 

        /**
         * åˆå§‹åŒ–æˆ–é‡ç½®éŠæˆ²ç‹€æ…‹
         */
        function initializeGame() {
            // è¨­ç½®åˆ†æ•¸å’Œæ™‚é–“
            score = 0;
            timeLeft = INITIAL_TIME;
            isRunning = true;

            // æ›´æ–°é¡¯ç¤º
            scoreEl.textContent = score;
            highscoreEl.textContent = highscore;
            timerEl.textContent = timeLeft;
            timerEl.classList.remove('time-low');
            gameOverOverlay.style.display = 'none';

            // åˆå§‹åŒ–é›»æ± é›»é‡ (éš¨æ©Ÿ 50% åˆ° 100%)
            batteryLevels = [];
            for (let i = 0; i < NUM_BATTERIES; i++) {
                batteryLevels.push(Math.floor(Math.random() * 50) + 50); // 50 to 100
            }

            // ç¹ªè£½é›»æ± 
            renderBatteries();

            // å•Ÿå‹•è¨ˆæ™‚å™¨
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(gameLoop, 1000);
        }

        /**
         * éŠæˆ²è¨ˆæ™‚å™¨ä¸»å¾ªç’°
         */
        function gameLoop() {
            if (!isRunning) return;

            timeLeft--;
            timerEl.textContent = timeLeft;

            if (timeLeft <= 10) {
                timerEl.classList.add('time-low');
            } else {
                timerEl.classList.remove('time-low');
            }

            if (timeLeft <= 0) {
                endGame();
            }
        }

        /**
         * éŠæˆ²çµæŸ
         */
        function endGame() {
            isRunning = false;
            clearInterval(timerInterval);
            
            // æ›´æ–°æœ€é«˜åˆ†æ•¸
            if (score > highscore) {
                highscore = score;
                localStorage.setItem('batteryHighscore', highscore);
                highscoreEl.textContent = highscore;
            }

            // é¡¯ç¤ºéŠæˆ²çµæŸç•«é¢
            finalScoreEl.textContent = score;
            gameOverOverlay.style.display = 'flex';
        }

        /**
         * æ ¹æ“šé›»é‡æ›´æ–°å–®å€‹é›»æ± çš„è¦–è¦ºç‹€æ…‹
         * @param {number} index - é›»æ± åœ¨é™£åˆ—ä¸­çš„ç´¢å¼•
         */
        function updateBatteryView(index) {
            const level = batteryLevels[index];
            const batteryEl = document.getElementById(`battery-${index}`);
            const chargeLevelEl = batteryEl.querySelector('.charge-level');

            // 1. æ›´æ–°é«˜åº¦
            chargeLevelEl.style.height = `${level}%`;

            // 2. æ›´æ–°é¡è‰² (ç§»é™¤èˆŠçš„é¡è‰²é¡åˆ¥)
            chargeLevelEl.classList.remove('charge-full', 'charge-mid', 'charge-low');
            
            if (level >= 75) {
                chargeLevelEl.classList.add('charge-full');
            } else if (level >= 30) {
                chargeLevelEl.classList.add('charge-mid');
            } else {
                chargeLevelEl.classList.add('charge-low');
            }
        }
        
        /**
         * è™•ç†é›»æ± é»æ“Šäº‹ä»¶
         * @param {number} index - è¢«é»æ“Šé›»æ± çš„ç´¢å¼•
         */
        function handleBatteryClick(index) {
            if (!isRunning) return;

            let currentLevel = batteryLevels[index];
            let newLevel;

            if (isDischargeMode) {
                // è€—é›»æ¨¡å¼ï¼šé»æ“Šæ‰£é›»ï¼Œåˆ†æ•¸å¢åŠ 
                newLevel = Math.max(0, currentLevel - DISCHARGE_AMOUNT);
                if (currentLevel > 0) {
                    score++;
                }
            } else {
                // å……é›»æ¨¡å¼ï¼šé»æ“Šå……é›»
                newLevel = Math.min(100, currentLevel + CHARGE_AMOUNT);
            }

            batteryLevels[index] = newLevel;
            scoreEl.textContent = score;

            updateBatteryView(index);

            // æª¢æŸ¥éŠæˆ²å¤±æ•—æ¢ä»¶ (ä¾‹å¦‚ï¼šè€—é›»æ¨¡å¼ä¸‹æ‰€æœ‰é›»æ± è€—ç›¡)
            if (isDischargeMode && batteryLevels.every(level => level === 0)) {
                // endGame(); // æš«æ™‚è¨»é‡‹ï¼Œè®“éŠæˆ²åªæ ¹æ“šæ™‚é–“çµæŸ
            }
        }


        /**
         * å‹•æ…‹ç”Ÿæˆ HTML é›»æ± å…ƒç´ 
         */
        function renderBatteries() {
            batteryContainer.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
            batteryLevels.forEach((level, index) => {
                const batteryEl = document.createElement('div');
                batteryEl.className = 'battery';
                batteryEl.id = `battery-${index}`;
                batteryEl.setAttribute('onclick', `handleBatteryClick(${index})`);

                // é›»é‡æ¢
                const chargeLevelEl = document.createElement('div');
                chargeLevelEl.className = 'charge-level';
                chargeLevelEl.style.height = `${level}%`;
                
                // ã€Œå½ˆç°§ã€æ–‡å­—
                const springTextEl = document.createElement('span');
                springTextEl.className = 'spring-text';
                springTextEl.textContent = 'å½ˆç°§';

                batteryEl.appendChild(chargeLevelEl);
                batteryEl.appendChild(springTextEl);
                batteryContainer.appendChild(batteryEl);

                // åˆå§‹åŒ–è¦–è¦ºé¡è‰²
                updateBatteryView(index);
            });
        }

        /**
         * åˆ‡æ›éŠæˆ²æ¨¡å¼ (è€—é›»/å……é›»)
         */
        function toggleMode() {
            isDischargeMode = !isDischargeMode;
            modeToggleBtn.textContent = `åˆ‡æ›æ¨¡å¼ (ç›®å‰: ${isDischargeMode ? 'è€—é›»' : 'å……é›»'})`;
        }

        /**
         * ç¶å®šäº‹ä»¶ç›£è½å™¨
         */
        document.getElementById('reset-button').addEventListener('click', initializeGame);
        modeToggleBtn.addEventListener('click', toggleMode);
        
        // å…¨åŸŸå‡½æ•¸ï¼Œç”¨æ–¼éŠæˆ²çµæŸç•«é¢æŒ‰éˆ•
        window.resetGame = initializeGame;


        // éŠæˆ²é–‹å§‹
        initializeGame();

    </script>
</body>
</html>